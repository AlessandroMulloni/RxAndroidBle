<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>RxAndroidBLE by Polidea</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>RxAndroidBLE</h1>
        <h2></h2>
        <a href="https://github.com/Polidea/RxAndroidBle" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="rxandroidble--" class="anchor" href="#rxandroidble--" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RxAndroidBle <a href="https://travis-ci.org/Polidea/RxAndroidBle"><img src="https://travis-ci.org/Polidea/RxAndroidBle.svg?branch=master" alt="Build Status"></a> <a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22com.polidea.rxandroidble%22%20AND%20a%3A%22rxandroidble%22"><img src="https://img.shields.io/maven-central/v/com.polidea.rxandroidble/rxandroidble.svg" alt="Maven Central"></a>
</h1>

<p><img src="https://raw.githubusercontent.com/Polidea/RxAndroidBle/master/site/viking-large.jpeg" alt="Polidea" title="Tailored software services including concept, design, development and testing"></p>

<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2>

<p>RxAndroidBle is a powerful painkiller for Android's Bluetooth Low Energy headaches. It is backed by RxJava, implementing complicated APIs as handy reactive observables. The library does for you:</p>

<ul>
<li>Fancy asynchronous operations support (read, write, notifications)</li>
<li>Threading management in order to meet Android contracts</li>
<li>Connection and operation error handling</li>
</ul>

<p>For support head to <a href="http://stackoverflow.com/questions/tagged/rxandroidble?sort=active">StackOverflow #rxandroidble</a></p>

<p>Read the official announcement at <a href="https://www.polidea.com/blog/RXAndroidBLE/">Polidea Blog</a>.</p>

<h2>
<a id="rxandroidble--mobile-central-europe-2016" class="anchor" href="#rxandroidble--mobile-central-europe-2016" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RxAndroidBLE @ Mobile Central Europe 2016</h2>

<p><a href="https://www.youtube.com/watch?v=0aKfUGCxUDM"><img src="https://img.youtube.com/vi/0aKfUGCxUDM/0.jpg" alt="RxAndroidBLE @ Mobile Central Europe 2016"></a></p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="obtaining-the-client" class="anchor" href="#obtaining-the-client" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Obtaining the client</h3>

<p>It's your job to maintain single instance of the client. You can use singleton, scoped <a href="http://google.github.io/dagger/">Dagger</a> component or whatever else you want.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">RxBleClient</span> rxBleClient <span class="pl-k">=</span> <span class="pl-smi">RxBleClient</span><span class="pl-k">.</span>create(context);</pre></div>

<h3>
<a id="device-discovery" class="anchor" href="#device-discovery" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Device discovery</h3>

<p>Scanning devices in the area is simple as that:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">Subscription</span> scanSubscription <span class="pl-k">=</span> rxBleClient<span class="pl-k">.</span>scanBleDevices()
    .subscribe(
        rxBleScanResult <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Process scan result here.</span>
        },
        throwable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Handle an error here.</span>
        }
    );

<span class="pl-c">// When done, just unsubscribe.</span>
scanSubscription<span class="pl-k">.</span>unsubscribe();</pre></div>

<h3>
<a id="connection" class="anchor" href="#connection" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Connection</h3>

<p>For further BLE interactions the connection is required.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">String</span> macAddress <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>AA:BB:CC:DD:EE:FF<span class="pl-pds">"</span></span>;
<span class="pl-smi">RxBleDevice</span> device <span class="pl-k">=</span> rxBleClient<span class="pl-k">.</span>getBleDevice(macAddress);

<span class="pl-smi">Subscription</span> subscription <span class="pl-k">=</span> device<span class="pl-k">.</span>establishConnection(context, <span class="pl-c1">false</span>) <span class="pl-c">// &lt;-- autoConnect flag</span>
    .subscribe(
        rxBleConnection <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// All GATT operations are done through the rxBleConnection.</span>
        },
        throwable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Handle an error here.</span>
        }
    );

<span class="pl-c">// When done... unsubscribe and forget about connection teardown :)</span>
subscription<span class="pl-k">.</span>unsubscribe();</pre></div>

<h4>
<a id="auto-connect" class="anchor" href="#auto-connect" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Auto connect</h4>

<p>After <a href="https://developer.android.com/reference/android/bluetooth/BluetoothDevice.html#connectGatt(android.content.Context">https://developer.android.com/reference/android/bluetooth/BluetoothDevice.html#connectGatt(android.content.Context</a>, boolean, android.bluetooth.BluetoothGattCallback):
autoConnect boolean: Whether to directly connect to the remote device (false) or to automatically connect as soon as the remote device becomes available (true).</p>

<p>Auto connect concept may be misleading at first glance. With the autoconnect flag set to false the connection will end up with an error if a BLE device is not advertising when the <code>RxBleDevice#establishConnection</code> method is called. From platform to platform timeout after which the error is emitted differs, but in general it is rather tens of seconds than single seconds.</p>

<p>Setting the auto connect flag to true allows you to wait until the BLE device becomes discoverable. The <code>RxBleConnection</code> instance won't be emitted until the connection is fully set up. From experience it also handles acquiring wake locks, so it's safe to assume that your Android device will be woken up after the connection has been established - but it is not a documented feature and may change in the future system releases.</p>

<p>Be careful not to overuse the autoConnect flag. On the other side it has negative impact on the connection initialization speed. Scanning window and interval is lowered as it is optimized for background use and depending on Bluetooth parameters it may (and usually do) take more time to establish the connection.</p>

<h3>
<a id="read--write-operations" class="anchor" href="#read--write-operations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Read / write operations</h3>

<h4>
<a id="read" class="anchor" href="#read" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Read</h4>

<div class="highlight highlight-source-java"><pre>device<span class="pl-k">.</span>establishConnection(context, <span class="pl-c1">false</span>)
    .flatMap(rxBleConnection <span class="pl-k">-</span><span class="pl-k">&gt;</span> rxBleConnection<span class="pl-k">.</span>readCharacteristic(characteristicUUID))
    .subscribe(
        characteristicValue <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Read characteristic value.</span>
        },
        throwable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Handle an error here.</span>
        }
    );
</pre></div>

<h4>
<a id="write" class="anchor" href="#write" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Write</h4>

<div class="highlight highlight-source-java"><pre>device<span class="pl-k">.</span>establishConnection(context, <span class="pl-c1">false</span>)
    .flatMap(rxBleConnection <span class="pl-k">-</span><span class="pl-k">&gt;</span> rxBleConnection<span class="pl-k">.</span>writeCharacteristic(characteristicUUID, bytesToWrite))
    .subscribe(
        characteristicValue <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Characteristic value confirmed.</span>
        },
        throwable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Handle an error here.</span>
        }
    );</pre></div>

<h4>
<a id="multiple-reads" class="anchor" href="#multiple-reads" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multiple reads</h4>

<div class="highlight highlight-source-java"><pre> device<span class="pl-k">.</span>establishConnection(context, <span class="pl-c1">false</span>)
    .flatMap(rxBleConnection <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-smi">Observable</span><span class="pl-k">.</span>combineLatest(
        rxBleConnection<span class="pl-k">.</span>readCharacteristic(firstUUID),
        rxBleConnection<span class="pl-k">.</span>readCharacteristic(secondUUID),
        <span class="pl-smi">YourModelCombiningTwoValues</span><span class="pl-k">::</span><span class="pl-k">new</span>
    ))
    .subscribe(
        model <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Process your model.</span>
        },
        throwable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Handle an error here.</span>
        }
    );</pre></div>

<h4>
<a id="read-and-write-combined" class="anchor" href="#read-and-write-combined" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Read and write combined</h4>

<div class="highlight highlight-source-java"><pre> device<span class="pl-k">.</span>establishConnection(context, <span class="pl-c1">false</span>)
    .flatMap(rxBleConnection <span class="pl-k">-</span><span class="pl-k">&gt;</span> rxBleConnection<span class="pl-k">.</span>readCharacteristic(characteristicUuid)
        .doOnNext(bytes <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Process read data.</span>
        })
        .flatMap(bytes <span class="pl-k">-</span><span class="pl-k">&gt;</span> rxBleConnection<span class="pl-k">.</span>writeCharacteristic(characteristicUuid, bytesToWrite)))
    .subscribe(
        writeBytes <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Written data.</span>
        },
        throwable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Handle an error here.</span>
        }
    );</pre></div>

<h3>
<a id="change-notifications" class="anchor" href="#change-notifications" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Change notifications</h3>

<div class="highlight highlight-source-java"><pre> device<span class="pl-k">.</span>establishConnection(context, <span class="pl-c1">false</span>)
    .flatMap(rxBleConnection <span class="pl-k">-</span><span class="pl-k">&gt;</span> rxBleConnection<span class="pl-k">.</span>setupNotification(characteristicUuid))
    .doOnNext(notificationObservable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
        <span class="pl-c">// Notification has been set up</span>
    })
    .flatMap(notificationObservable <span class="pl-k">-</span><span class="pl-k">&gt;</span> notificationObservable) <span class="pl-c">// &lt;-- Notification has been set up, now observe value changes.</span>
    .subscribe(
        bytes <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Given characteristic has been changes, here is the value.</span>
        },
        throwable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Handle an error here.</span>
        }
    );
</pre></div>

<h3>
<a id="observing-connection-state" class="anchor" href="#observing-connection-state" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Observing connection state</h3>

<p>If you want to observe changes in device connection state just subscribe like below. On subscription you will receive the most current state instantly.</p>

<div class="highlight highlight-source-java"><pre>device<span class="pl-k">.</span>observeConnectionStateChanges()
    .subscribe(
        connectionState <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Process your way.</span>
        },
        throwable <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// Handle an error here.</span>
        }
    );</pre></div>

<h3>
<a id="logging" class="anchor" href="#logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logging</h3>

<p>For connection debugging you can use extended logging</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">RxBleClient</span><span class="pl-k">.</span>setLogLevel(<span class="pl-smi">RxBleLog</span><span class="pl-c1"><span class="pl-k">.</span>DEBUG</span>);</pre></div>

<h3>
<a id="error-handling" class="anchor" href="#error-handling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Error handling</h3>

<p>Every error you may encounter is provided via onError callback. Each public method has JavaDoc explaining possible errors.</p>

<h2>
<a id="more-examples" class="anchor" href="#more-examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>More examples</h2>

<p>Complete usage examples are located in <code>/sample</code> <a href="https://github.com/Polidea/RxAndroidBle/tree/master/sample/src/main/java/com/polidea/rxandroidble/sample">GitHub repo</a>.</p>

<h2>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Download</h2>

<h3>
<a id="gradle" class="anchor" href="#gradle" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Gradle</h3>

<div class="highlight highlight-source-java"><pre>compile <span class="pl-s"><span class="pl-pds">"</span>com.polidea.rxandroidble:rxandroidble:1.1.0<span class="pl-pds">"</span></span></pre></div>

<h3>
<a id="maven" class="anchor" href="#maven" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Maven</h3>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;com.polidea.rxandroidble&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;rxandroidble&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;1.1.0&lt;/<span class="pl-ent">version</span>&gt;
  &lt;<span class="pl-ent">type</span>&gt;aar&lt;/<span class="pl-ent">type</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<h2>
<a id="unit-testing" class="anchor" href="#unit-testing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Unit testing</h2>

<p>Using RxAndroidBle enables you to unit test your application easily. For examples how to use mocking head to <a href="https://github.com/Polidea/RxAndroidBle/tree/master/mockrxandroidble">MockRxAndroidBle</a>.</p>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributing</h2>

<p>If you would like to contribute code you can do so through GitHub by forking the repository and sending a pull request.</p>

<p>When submitting code, please make every effort to follow existing conventions and style in order to keep the code as readable as possible. Please also make sure your code compiles by running <code>./gradlew clean checkstyle test</code>.</p>

<h2>
<a id="maintainers" class="anchor" href="#maintainers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Maintainers</h2>

<ul>
<li>Dariusz Seweryn (<a href="mailto:dariusz.seweryn@polidea.com">dariusz.seweryn@polidea.com</a>)</li>
<li>Paweł Urban (<a href="mailto:pawel.urban@polidea.com">pawel.urban@polidea.com</a>)</li>
</ul>

<h2>
<a id="contributors-thank-you" class="anchor" href="#contributors-thank-you" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributors, thank you!</h2>

<ul>
<li>Michał Zieliński (<a href="mailto:michal.zielinski@polidea.com">michal.zielinski@polidea.com</a>)</li>
<li>Fracturedpsyche (<a href="https://github.com/fracturedpsyche">https://github.com/fracturedpsyche</a>)</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<pre><code>Copyright 2016 Polidea Sp. z o.o

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>

<h2>
<a id="maintained-by" class="anchor" href="#maintained-by" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Maintained by</h2>

<p><a href="http://www.polidea.com"><img src="https://raw.githubusercontent.com/Polidea/RxAndroidBle/master/site/polidea_logo.png" alt="Polidea" title="Tailored software services including concept, design, development and testing"></a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/Polidea/RxAndroidBle/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/Polidea/RxAndroidBle/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/Polidea/RxAndroidBle"></a> is maintained by <a href="https://github.com/Polidea">Polidea</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
